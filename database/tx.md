# 数据库事务

- [数据库事务](#数据库事务)
    - [ACID 属性](#acid-属性)
      - [Atomic（原子性）](#atomic原子性)
      - [Consistent（一致性）](#consistent一致性)
      - [Isolated（隔离性）](#isolated隔离性)
      - [Durable（持久性）](#durable持久性)
    - [数据库事务的数据异常现象](#数据库事务的数据异常现象)
      - [脏读](#脏读)
      - [不可重复读](#不可重复读)
      - [幻读](#幻读)
      - [脏写](#脏写)
      - [写丢失](#写丢失)
      - [游标写丢失](#游标写丢失)
      - [读倾斜](#读倾斜)
      - [写倾斜](#写倾斜)
    - [数据库事务的隔离级别](#数据库事务的隔离级别)
      - [读未提交](#读未提交)
      - [读提交](#读提交)
      - [可重复读](#可重复读)
      - [可串行化](#可串行化)
  
---

### ACID 属性
#### Atomic（原子性）
事务内所有的操作都是不可再分的整体执行
#### Consistent（一致性）
事务执行前后的数据状态保持一致
#### Isolated（隔离性）
多个事务并发执行时，各个事务之间应该是相互隔离的，在自己事务结束之前不能看到对方事务的更新。
#### Durable（持久性）
确保成功执行的事务对数据所做的更改被保存

### 数据库事务的数据异常现象
#### 脏读
事务执行读操作得到的数据时不合法的。读到了未提交事务的数据变更。
#### 不可重复读
事务A中执行了两次读同一数据，由于事务B的更新操作导致前后两次读的数据不一致
#### 幻读
事务A读取某一个范围的所有数据并进行修改，同时事务B在该范围内新增一行数据，当事务A再次读取相同行时，将发现一个新的幻影行。幻读主要涉及的操作时插入，不可重复度涉及的是更新。
#### 脏写
两个事务同时写一个key发生冲突的现象
#### 写丢失
事务A在尝试根据读到的数据进行写入之前，在事务B上有另外的写入操作发生在了事务A的读写操作之间，两个事务都提交成功，事务B的写操作丢失
#### 游标写丢失
事务A执行读操作后，游标会进行记录，如果借助锁机制对游标当前包含的数据上锁，事务B在事务A执行期间无法对该数据进行写操作，可以称该操作避免了游标写丢失现象的发生。
#### 读倾斜
指事务读操作观察到了违反应用程序规则的数据。前后读取不同key的数据，读到的数据违反了约束。
#### 写倾斜
指多个事务写入同一个对象的时候发生的异常

### 数据库事务的隔离级别
#### 读未提交
处于该隔离级别的数据库事务可以看到其他事务中未提交的数据 => 脏读
#### 读提交
- 只能读到已经完成提交的数据
- 只能覆盖已经完成提交的数据
能够避免脏读，但是不能避免不可重复读和读倾斜
#### 可重复读
可以避免出现不可重复读和度倾斜的异常现象，但是无法避免幻读现象
#### 可串行化
最严格的隔离级别。
- 以串行方式执行事务
- 并发控制协议：悲观并发控制协议，乐观并发控制协议，多版本并发控制协议
_Redis是一个经典的单线程数据库，就是使用串行方式执行事务。_