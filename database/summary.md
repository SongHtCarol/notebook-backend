# 数据库

> reference:<br>
> https://zh.wikipedia.org/wiki/%E6%95%B0%E6%8D%AE%E5%BA%93<br>
> [《数据库系统原理及应用教程》](http://s.cmpedu.com/booksource/upload/pdf/YZ_08594T.pdf)<br>
> [《分布式数据库系统及其应用》](https://www.ecsponline.com/yz/B0A3CE3D9612740D5B6F861FFE67E4C21000.pdf)
- [数据库](#数据库)
  - [什么是数据库？以及数据库管理系统](#什么是数据库以及数据库管理系统)
  - [锁](#锁)

---

## 什么是数据库？以及数据库管理系统
**数据库**`是以一定方式储存在一起、能予多个用户共享、具有尽可能小的冗余度、与应用程序彼此独立的数据集合。一个数据库由多个表空间（Tablespace）构成。`

**数据库管理系统（Database Management System）**：`为管理数据库而设计的电脑软件系统，一般具有存储、截取、安全保障、备份等基础功能`

<img src='/database/img/mindnote.png'>

## 锁
_表级锁和行级锁对比_
表级锁和行级锁是数据库中两种常见的锁机制，用于控制并发访问数据时的资源争用。它们在锁的粒度、并发性能和应用场景上有显著区别。以下是表级锁和行级锁的详细对比：


### 1. **锁的粒度**
- **表级锁**：
  - 锁定整个表。
  - 当一个会话对表加锁时，其他会话无法对该表进行写操作（读操作可能允许，取决于锁类型）。
- **行级锁**：
  - 锁定表中的某一行或几行。
  - 当一个会话对某行加锁时，其他会话仍然可以访问表中的其他行。


### 2. **并发性能**
- **表级锁**：
  - **优点**：实现简单，开销小。
  - **缺点**：并发性能差，多个会话无法同时修改同一表的不同行。
- **行级锁**：
  - **优点**：并发性能高，多个会话可以同时修改同一表的不同行。
  - **缺点**：实现复杂，开销较大。


### 3. **锁的类型**
- **表级锁**：
  - **读锁（共享锁）**：允许其他会话读取表，但不允许写入。
  - **写锁（排他锁）**：不允许其他会话读取或写入表。
- **行级锁**：
  - **共享锁（S锁）**：允许其他会话读取同一行，但不允许写入。
  - **排他锁（X锁）**：不允许其他会话读取或写入同一行。


### 4. **适用场景**
- **表级锁**：
  - 适合读多写少的场景。
  - 适合数据量较小的表。
  - 适合不需要高并发的应用。
- **行级锁**：
  - 适合写多读少的场景。
  - 适合数据量较大的表。
  - 适合需要高并发的应用。


### 5. **实现复杂度**
- **表级锁**：
  - 实现简单，数据库只需管理表的锁状态。
- **行级锁**：
  - 实现复杂，数据库需要管理每行的锁状态，开销较大。


### 6. **死锁问题**
- **表级锁**：
  - 死锁概率低，因为锁的粒度大，会话之间的竞争较少。
- **行级锁**：
  - 死锁概率较高，因为多个会话可能同时竞争同一表的不同行。


### 7. **示例对比**
#### 表级锁（MyISAM）
```sql
-- 会话1
LOCK TABLE my_table WRITE; -- 加写锁
INSERT INTO my_table VALUES (1, 'Alice');
-- 其他会话无法读取或写入 my_table
UNLOCK TABLES; -- 释放锁

-- 会话2
SELECT * FROM my_table; -- 等待会话1释放锁
```

#### 行级锁（InnoDB）
```sql
-- 会话1
START TRANSACTION;
SELECT * FROM my_table WHERE id = 1 FOR UPDATE; -- 对 id=1 的行加排他锁
UPDATE my_table SET name = 'Bob' WHERE id = 1;
COMMIT; -- 释放锁

-- 会话2
START TRANSACTION;
SELECT * FROM my_table WHERE id = 2 FOR UPDATE; -- 可以访问其他行
UPDATE my_table SET name = 'Charlie' WHERE id = 2;
COMMIT;
```


### 8. **性能对比**
| 特性            | 表级锁       | 行级锁       |
|-----------------|--------------|--------------|
| **锁粒度**      | 粗粒度       | 细粒度       |
| **并发性能**    | 低           | 高           |
| **实现复杂度**  | 简单         | 复杂         |
| **死锁概率**    | 低           | 高           |
| **适用场景**    | 读多写少     | 写多读少     |


### 9. **总结**
- **表级锁**：适合读多写少、数据量小的场景，实现简单但并发性能差。
- **行级锁**：适合写多读少、数据量大的场景，实现复杂但并发性能高。
